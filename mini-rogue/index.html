<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ãƒŸãƒ‹ãƒ­ãƒ¼ã‚°ï¼š3æŠãƒ€ãƒ³ã‚¸ãƒ§ãƒ³</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121a33; --text:#e8ecff; --muted:#a8b0d6;
      --accent:#66e3ff; --ok:#6dff9b; --bad:#ff6b8a; --shadow:0 12px 30px rgba(0,0,0,.35);
      --r:18px;
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color:transparent;}
    body{
      margin:0; min-height:100vh; display:flex; justify-content:center; align-items:center;
      padding:16px; color:var(--text);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif;
      background: radial-gradient(1000px 700px at 20% 10%, #1b2a63 0%, transparent 55%),
                  radial-gradient(900px 700px at 90% 20%, #1e5a5f 0%, transparent 55%),
                  var(--bg);
    }
    .app{
      width:min(600px,100%);
      background: rgba(18,26,51,.86);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    header{padding:18px 18px 10px; border-bottom:1px solid rgba(255,255,255,.08);}
    h1{margin:0 0 6px; font-size:18px;}
    .sub{margin:0; color:var(--muted); font-size:13px; line-height:1.4;}
    main{padding:16px 18px 18px;}
    .row{display:flex; gap:12px; flex-wrap:wrap;}
    .card{background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:14px;}
    .stats{display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px;}
    .stat{background:rgba(0,0,0,.18); border:1px solid rgba(255,255,255,.06); border-radius:14px; padding:12px;}
    .label{color:var(--muted); font-size:12px;}
    .value{font-size:20px; font-weight:800; margin-top:4px;}
    .bar{height:10px; border-radius:999px; background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.06); overflow:hidden; margin-top:8px;}
    .bar > div{height:100%; width:50%; background:linear-gradient(90deg,var(--accent),#7cffc9); transition:width .2s;}
    .log{min-height:120px; line-height:1.55; color:var(--text);}
    .log small{color:var(--muted);}
    .choices{display:grid; gap:10px; grid-template-columns:1fr; margin-top:12px;}
    button{
      border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.06);
      color:var(--text); border-radius:16px; padding:14px 14px; font-weight:800; font-size:15px;
    }
    button:active{transform:translateY(1px);}
    .primary{background:rgba(102,227,255,.16); border-color:rgba(102,227,255,.35);}
    .ok{background:rgba(109,255,155,.12); border-color:rgba(109,255,155,.35);}
    .bad{background:rgba(255,107,138,.12); border-color:rgba(255,107,138,.35);}
    .muted{color:var(--muted);}
    .pill{display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; font-weight:900; border:1px solid rgba(255,255,255,.12); margin-right:6px;}
    .pill.ok{background:rgba(109,255,155,.14); border-color:rgba(109,255,155,.35);}
    .pill.bad{background:rgba(255,107,138,.14); border-color:rgba(255,107,138,.35);}
    .pill.neu{background:rgba(102,227,255,.12); border-color:rgba(102,227,255,.35);}
    .footer{display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;}
    .footer button{flex:1 1 160px;}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>ãƒŸãƒ‹ãƒ­ãƒ¼ã‚°ï¼š3æŠãƒ€ãƒ³ã‚¸ãƒ§ãƒ³</h1>
      <p class="sub">1ãƒ—ãƒ¬ã‚¤1ã€œ3åˆ†ã€‚æ¯ã‚¿ãƒ¼ãƒ³3æŠã‚’é¸ã‚“ã§<b>5éšå±¤</b>çªç ´ï¼ HP0ã§æ•—åŒ—ã€‚</p>
    </header>
    <main>
      <section class="card">
        <div class="stats">
          <div class="stat">
            <div class="label">ã‚ãªãŸ</div>
            <div class="value"><span id="hp">20</span>/<span id="maxhp">20</span> HP</div>
            <div class="bar"><div id="hpbar"></div></div>
          </div>
          <div class="stat">
            <div class="label">æ•µ</div>
            <div class="value"><span id="ehp">10</span>/<span id="emaxhp">10</span> HP</div>
            <div class="bar"><div id="ehpbar"></div></div>
          </div>
          <div class="stat">
            <div class="label">é€²è¡Œ</div>
            <div class="value">éšå±¤ <span id="floor">1</span> / <span id="goal">5</span></div>
            <div class="muted" style="margin-top:8px;font-size:12px;">é˜²å¾¡: <b id="block">0</b></div>
          </div>
        </div>
      </section>

      <section class="card" style="margin-top:12px;">
        <div class="log" id="log"></div>
        <div class="choices" id="choices"></div>
        <div class="footer">
          <button id="restart" class="primary">ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
          <button id="share">çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
        </div>
      </section>
    </main>
  </div>

<script>
(() => {
  const $ = (id)=>document.getElementById(id);

  const GOAL = 5;
  const state = {
    floor: 1,
    maxhp: 20,
    hp: 20,
    block: 0,
    enemy: { maxhp: 10, hp: 10, atkMin: 3, atkMax: 6 },
    turns: 0,
    over: false,
    won: false,
    lastMsg: ""
  };

  function r(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

  function enemyForFloor(f){
    // éšå±¤ãŒä¸ŠãŒã‚‹ã»ã©ã¡ã‚‡ã„å¼·ã
    const base = 8 + f*3;
    return {
      maxhp: base,
      hp: base,
      atkMin: 2 + f,
      atkMax: 4 + f*2
    };
  }

  function ui(){
    $("hp").textContent = state.hp;
    $("maxhp").textContent = state.maxhp;
    $("ehp").textContent = state.enemy.hp;
    $("emaxhp").textContent = state.enemy.maxhp;
    $("floor").textContent = state.floor;
    $("goal").textContent = GOAL;
    $("block").textContent = state.block;

    $("hpbar").style.width = `${(state.hp/state.maxhp)*100}%`;
    $("ehpbar").style.width = `${(state.enemy.hp/state.enemy.maxhp)*100}%`;
  }

  function log(html){
    $("log").innerHTML = html;
  }

  function setChoices(arr){
    const wrap = $("choices");
    wrap.innerHTML = "";
    arr.forEach(c => {
      const b = document.createElement("button");
      b.className = c.cls || "";
      b.innerHTML = c.label;
      b.disabled = state.over;
      b.addEventListener("click", c.onClick);
      wrap.appendChild(b);
    });
  }

  function start(){
    state.floor = 1;
    state.maxhp = 20;
    state.hp = 20;
    state.block = 0;
    state.enemy = enemyForFloor(1);
    state.turns = 0;
    state.over = false;
    state.won = false;
    state.lastMsg = "";
    renderTurnIntro(true);
  }

  function renderTurnIntro(first=false){
    ui();
    const tip = first ? "ã¾ãšã¯1æ‰‹é¸ã‚“ã§ã­ã€‚" : "æ¬¡ã®1æ‰‹ï¼";
    log(`<span class="pill neu">éšå±¤${state.floor}</span>${tip}<br><small>â€» é˜²å¾¡ã¯æ¬¡ã®æ•µæ”»æ’ƒã«ã ã‘æœ‰åŠ¹</small>`);
    setChoices(makeChoices());
  }

  function makeChoices(){
    // 3æŠï¼šæ”»æ’ƒ / é˜²å¾¡ / å›å¾©ï¼ˆãŸã¾ã«ç‰¹æ®Šï¼‰
    const atk = () => {
      const dmg = r(4, 7) + Math.floor(state.floor/2);
      state.enemy.hp = clamp(state.enemy.hp - dmg, 0, state.enemy.maxhp);
      state.lastMsg = `ã‚ãªãŸã®æ”»æ’ƒï¼ æ•µã« ${dmg} ãƒ€ãƒ¡ãƒ¼ã‚¸ã€‚`;
      afterPlayerAction();
    };

    const guard = () => {
      const b = r(4, 8) + state.floor;
      state.block = b;
      state.lastMsg = `é˜²å¾¡ï¼ æ¬¡ã®è¢«ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’ ${b} è»½æ¸›ã€‚`;
      afterPlayerAction();
    };

    const heal = () => {
      const h = r(4, 7);
      state.hp = clamp(state.hp + h, 0, state.maxhp);
      state.lastMsg = `å›å¾©ï¼ HPã‚’ ${h} å›å¾©ã€‚`;
      afterPlayerAction();
    };

    // ã¡ã‚‡ã„ãƒ­ãƒ¼ã‚°æ„Ÿï¼šä½ç¢ºç‡ã§ã€Œã‚®ãƒ£ãƒ³ãƒ–ãƒ«ã€ã‚„ã€Œå¼·åŒ–ã€
    const roll = Math.random();
    const choices = [
      { label: `âš”ï¸ æ”»æ’ƒ <span class="muted">(${4+Math.floor(state.floor/2)}ã€œ${7+Math.floor(state.floor/2)})</span>`, cls:"primary", onClick: atk },
      { label: `ğŸ›¡ï¸ é˜²å¾¡ <span class="muted">(è»½æ¸› 5ã€œ${8+state.floor})</span>`, cls:"ok", onClick: guard },
      { label: `ğŸ’š å›å¾© <span class="muted">(4ã€œ7)</span>`, cls:"ok", onClick: heal },
    ];

    // 25%ã§ã©ã‚Œã‹1ã¤ã‚’ç‰¹æ®Šã«å·®ã—æ›¿ãˆ
    if(roll < 0.25){
      const idx = r(0,2);
      const special = (Math.random() < 0.5)
        ? { // ã‚®ãƒ£ãƒ³ãƒ–ãƒ«æ”»æ’ƒ
            label:`ğŸ² è³­ã‘æ”»æ’ƒ <span class="muted">(0 or å¤§ãƒ€ãƒ¡)</span>`,
            cls:"bad",
            onClick: ()=>{
              const hit = Math.random() < 0.55;
              const dmg = hit ? r(10, 16) : 0;
              state.enemy.hp = clamp(state.enemy.hp - dmg, 0, state.enemy.maxhp);
              state.lastMsg = hit ? `è³­ã‘æˆåŠŸï¼ ${dmg} ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼` : `è³­ã‘å¤±æ•—â€¦ 0ãƒ€ãƒ¡ãƒ¼ã‚¸ã€‚`;
              afterPlayerAction();
            }
          }
        : { // æœ€å¤§HPå¢—åŠ ï¼ˆå¾®å›å¾©ä»˜ãï¼‰
            label:`âœ¨ å¼·åŒ– <span class="muted">(+3 æœ€å¤§HP)</span>`,
            cls:"primary",
            onClick: ()=>{
              state.maxhp += 3;
              state.hp = clamp(state.hp + 2, 0, state.maxhp);
              state.lastMsg = `å¼·åŒ–ï¼ æœ€å¤§HP +3ï¼ˆã¤ã„ã§ã«HP+2ï¼‰ã€‚`;
              afterPlayerAction();
            }
          };
      choices[idx] = special;
    }

    return choices;
  }

  function afterPlayerAction(){
    state.turns++;

    // æ•µãŒå€’ã‚ŒãŸï¼Ÿ
    if(state.enemy.hp <= 0){
      if(state.floor >= GOAL){
        state.over = true;
        state.won = true;
        ui();
        log(`<span class="pill ok">å‹åˆ©</span>${state.lastMsg}<br>æœ€çµ‚éšå±¤ã‚’çªç ´ï¼<br><b>${state.turns}</b>æ‰‹ã§ã‚¯ãƒªã‚¢ï¼`);
        setChoices([{label:"ã‚‚ã†ä¸€å›", cls:"primary", onClick:start}]);
        return;
      }

      // æ¬¡ã®éšå±¤ã¸
      state.floor++;
      const reward = r(1,3);
      state.hp = clamp(state.hp + reward, 0, state.maxhp); // å°å›å¾©
      state.block = 0;
      state.enemy = enemyForFloor(state.floor);
      ui();
      log(`<span class="pill ok">æ’ƒç ´</span>${state.lastMsg}<br>éšå±¤${state.floor-1}ã‚¯ãƒªã‚¢ï¼ å°å›å¾© +${reward}<br><small>æ¬¡ã®æ•µãŒç¾ã‚ŒãŸâ€¦</small>`);
      setChoices([{label:"æ¬¡ã¸", cls:"primary", onClick: renderTurnIntro}]);
      return;
    }

    // æ•µã®åæ’ƒ
    enemyTurn();
  }

  function enemyTurn(){
    const atk = r(state.enemy.atkMin, state.enemy.atkMax);
    const reduced = Math.min(state.block, atk);
    const dmg = atk - reduced;
    state.block = 0;
    state.hp = clamp(state.hp - dmg, 0, state.maxhp);

    ui();

    if(state.hp <= 0){
      state.over = true;
      state.won = false;
      log(`<span class="pill bad">æ•—åŒ—</span>${state.lastMsg}<br>æ•µã®æ”»æ’ƒ ${atk}ï¼ˆè»½æ¸› ${reduced}ï¼‰â†’ è¢«ãƒ€ãƒ¡ ${dmg}<br><b>HPãŒ0ã«ãªã£ãŸâ€¦</b><br><small>åˆ°é”ï¼šéšå±¤${state.floor} / ${GOAL}ï¼ˆ${state.turns}æ‰‹ï¼‰</small>`);
      setChoices([{label:"å†æŒ‘æˆ¦", cls:"primary", onClick:start}]);
      return;
    }

    log(`${state.lastMsg}<br>æ•µã®æ”»æ’ƒ ${atk}ï¼ˆè»½æ¸› ${reduced}ï¼‰â†’ è¢«ãƒ€ãƒ¡ ${dmg}<br><small>æ¬¡ã®ä¸€æ‰‹ã‚’é¸ã‚“ã§ã­ã€‚</small>`);
    setChoices(makeChoices());
  }

  $("restart").addEventListener("click", start);

  $("share").addEventListener("click", async ()=>{
    const text = state.over
      ? `ãƒŸãƒ‹ãƒ­ãƒ¼ã‚°çµæœï¼š${state.won ? "å‹åˆ©" : "æ•—åŒ—"} / åˆ°é”: ${state.floor}/${GOAL} / æ‰‹æ•°: ${state.turns} / HP: ${state.hp}/${state.maxhp}`
      : `ãƒŸãƒ‹ãƒ­ãƒ¼ã‚°é€²è¡Œä¸­ï¼šéšå±¤ ${state.floor}/${GOAL} / æ‰‹æ•° ${state.turns} / HP ${state.hp}/${state.maxhp}`;
    try{
      await navigator.clipboard.writeText(text);
      alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\n" + text);
    }catch(e){
      prompt("ã“ã‚Œã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã­", text);
    }
  });

  start();
})();
</script>
</body>
</html>
